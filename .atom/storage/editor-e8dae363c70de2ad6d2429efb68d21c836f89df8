{"version":1,"windowDimensions":{"x":0,"y":0,"width":1425,"height":885,"maximized":false},"grammars":{"grammarOverridesByPath":{}},"project":{"deserializer":"Project","paths":["/Users/vmaudgalya/projects/merchant-experience-platform/uploader"],"buffers":[{"id":"c8c7ee8fd8ba740f3b239554105a78c0","text":"MERGE ({{prevCol}})-[:IN {condition: \"{{colName}}\", value: row.{{colName}} }]->({{colName}}:Transition)  \n{{innerText}}\n","defaultMarkerLayerId":"0","markerLayers":{"0":{"id":"0","maintainHistory":false,"markersById":{},"version":2},"1":{"id":"1","maintainHistory":false,"markersById":{},"version":2},"2":{"id":"2","maintainHistory":true,"markersById":{"1":{"range":{"start":{"row":0,"column":0},"end":{"row":0,"column":0}},"properties":{"type":"selection","preserveFolds":true},"reversed":false,"tailed":false,"valid":true,"invalidate":"never"}},"version":2},"3":{"id":"3","maintainHistory":false,"markersById":{},"version":2}},"nextMarkerLayerId":4,"history":{"version":3,"nextCheckpointId":1,"undoStack":[],"redoStack":[]},"encoding":"utf8","filePath":"/Users/vmaudgalya/projects/merchant-experience-platform/uploader/lib/_process_col.tmpl","digestWhenLastPersisted":"59fffe8245b13277f33da3b43cada0eaf489a997","preferredLineEnding":null,"nextMarkerId":2,"deserializer":"TextBuffer","version":5},{"id":"8895ffe32253885b76f652ff82e6b9ed","text":"// through2 is a thin wrapper around node transform streams\nvar through = require('through2');\nvar gutil = require('gulp-util');\nvar PluginError = gutil.PluginError;\nvar Uploader = require('./lib/Uploader');\n// var Translator = require('./lib/Translator');\n\n// Consts\nconst PLUGIN_NAME = 'uploader';\n\n// function translate (options) {\n//\n//   if (!options.engineKey || !options.engine) {\n//     throw new PluginError(PLUGIN_NAME, 'Missing Engine or Engine Key parameter!');\n//   }\n//\n//   if (!options.languages) {\n//     throw new PluginError(PLUGIN_NAME, 'Missing languages!');\n//   }\n//\n//   if (!options.appName) {\n//     throw new PluginError(PLUGIN_NAME, 'The appName parameter is missing!');\n//   }\n//   return through.obj(Translator(options));\n// }\n\nfunction upload (options) {\n\n  if (!options.neoConnectionString) {\n    throw new PluginError(PLUGIN_NAME, 'Missing neoConnectionString!');\n  }\n\n  if (!options.appName) {\n    throw new PluginError(PLUGIN_NAME, 'The appName parameter is missing!');\n  }\n  return through.obj(Uploader(options));\n}\n\nmodule.exports = {\n  upload : upload\n  // ,\n  // translate: translate\n}","defaultMarkerLayerId":"0","markerLayers":{"0":{"id":"0","maintainHistory":false,"markersById":{},"version":2},"1":{"id":"1","maintainHistory":false,"markersById":{},"version":2},"2":{"id":"2","maintainHistory":true,"markersById":{"1":{"range":{"start":{"row":1,"column":4},"end":{"row":1,"column":11}},"properties":{"type":"selection","goalScreenRange":null,"autoscroll":false,"preserveFolds":true},"reversed":false,"tailed":true,"valid":true,"invalidate":"never"}},"version":2},"3":{"id":"3","maintainHistory":false,"markersById":{},"version":2}},"nextMarkerLayerId":4,"history":{"version":3,"nextCheckpointId":1,"undoStack":[],"redoStack":[]},"encoding":"utf8","filePath":"/Users/vmaudgalya/projects/merchant-experience-platform/uploader/index.js","digestWhenLastPersisted":"763aab1bec184c627646a252faea790c5d7b25e4","preferredLineEnding":null,"nextMarkerId":8,"deserializer":"TextBuffer","version":5},{"id":"952d2bf8871a2d7b4ddf9d6b4c898329","text":"\nvar neo4j = require('node-neo4j');\nvar os = require('os');\nvar Q = require('q');\nvar fs = require('fs');\nvar Handlebars = require('handlebars');\nvar util = require(\"util\");\nvar gutil = require('gulp-util');\nvar _ = require('underscore');\nvar ip = require('ip');\n\nfunction startServer (fileContent) {\n    var deferred = Q.defer();\n    var contentWithDefaults = fileContent.replace(/,,/g, \",default,\").replace(/,,/g, \",default,\");\n\n    var httpServer = require('http').createServer(function (req, res) {\n        if (req.url.indexOf(\".csv\") > -1) {\n            res.writeHead(200, {'Content-Type': 'text/plain'});\n            res.end(contentWithDefaults);            \n            req.connection.destroy();\n            try {\n                httpServer.close();    \n            } catch (e) {}\n        }\n        res.end();            \n    }).listen(0, function () {        \n        deferred.resolve(ip.address() + \":\" + httpServer.address().port);\n    });\n    return deferred.promise;\n}\n\nfunction getColNames (fileContent) {  \n    return fileContent.split('\\n')[0].split(\",\");\n}\n\nfunction addNameSpace (appName, fileContent) {\n    return fileContent.replace(/\\n/g, \"\\n\" + appName + \"/\");\n}\n\nfunction getCypher (params, colNames) {\n  \n  var processColStr = fs.readFileSync(__dirname + '/_process_col.tmpl', 'utf8');\n\n  var compiled = Handlebars.compile(fs.readFileSync(__dirname + '/upload.tmpl', 'utf8'), {noEscape: true});\n  var variations = colNames.splice(1, colNames.length - 2);  \n\n  params.colsCypher = variations.reduce(function (prev, curr, index) {\n\n    var lastVariation = variations[variations.length - 1];\n    var meansQuery = util.format(\"CREATE UNIQUE (%s)-[:MEANS]->(t)\", lastVariation);\n    var innerText = index === variations.length - 1 ? meansQuery : processColStr;\n\n    return Handlebars.compile(prev, {noEscape: true})({colName : curr,\n                                    prevCol : index > 0? variations[index - 1] : \"w\",\n                                    innerText : innerText\n                                  });\n  }, processColStr);\n\n  return compiled(params);\n}\n\nmodule.exports = function Uploader (options) {\n    \n    options = _.defaults(options, {\n        neoConnectionString : \"http://neo4j:pass@localhost:7474\"\n    });\n\n    return function (file, enc, cb) {\n        if (file.isNull()) {\n          return cb(null, file);\n        }\n        // if (file.isStream()) {\n        //   file.contents = file.contents.pipe(prefixStream(prefixText));\n        // }\n\n        var fileContent = file.contents.toString('utf8').replace(/\\r/g, \"\\n\");\n        fileContent = addNameSpace(options.appName, fileContent);\n\n        var db = new neo4j(options.neoConnectionString);\n        var colNames = getColNames(fileContent);\n\n        // gutil.log('Column Names', colNames, gutil.colors.magenta('123'));\n\n        startServer(fileContent).then(function (hostURI) {\n            var cypher = getCypher({ hostURI : hostURI, appName : options.appName }, colNames);  \n\n            // gutil.log(cypher);        \n            db.cypherQuery(cypher, function () {\n                cb(null, file);\n            }); \n        });    \n    }\n}\n","defaultMarkerLayerId":"0","markerLayers":{"0":{"id":"0","maintainHistory":false,"markersById":{"24":{"range":{"start":{"row":68,"column":27},"end":{"row":68,"column":28}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap"},"25":{"range":{"start":{"row":70,"column":8},"end":{"row":70,"column":9}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap"},"26":{"range":{"start":{"row":68,"column":27},"end":{"row":68,"column":28}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap"},"27":{"range":{"start":{"row":70,"column":8},"end":{"row":70,"column":9}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap"}},"version":2},"1":{"id":"1","maintainHistory":false,"markersById":{},"version":2},"2":{"id":"2","maintainHistory":true,"markersById":{"1":{"range":{"start":{"row":68,"column":28},"end":{"row":68,"column":28}},"properties":{"type":"selection","goalScreenRange":null,"autoscroll":false,"preserveFolds":true},"reversed":false,"tailed":false,"valid":true,"invalidate":"never"}},"version":2},"3":{"id":"3","maintainHistory":false,"markersById":{},"version":2}},"nextMarkerLayerId":4,"history":{"version":3,"nextCheckpointId":1,"undoStack":[],"redoStack":[]},"encoding":"utf8","filePath":"/Users/vmaudgalya/projects/merchant-experience-platform/uploader/lib/Uploader.js","digestWhenLastPersisted":"2c519585da8369f1a05ce83972d442a558eb5af1","preferredLineEnding":null,"nextMarkerId":28,"deserializer":"TextBuffer","version":5},{"id":"d6b7a5d3194201140a602d302591424c","text":"# i18nize\n\nUpload your csv content files to a neo4j database. Translate the text with Google/Yandex Translate.\n\nCSV Sample\n\n\tkey,country,value\n\twelcome,,Welcome\n\twelcome,GB,Good Morning\n\tinstall,,Install\n\tinstall,JP,Add\n\thi,,Hi\n\thi,GB,Welcome\n\thi,IN,Namaste\n\topen,,Open\n\topen,GB,Expand\n\n\tkey(mandatory): Key you use in your templates to look-up text.\n\tcountry: A variation based on country. Use this to add adaptations.\n\tvalue(mandatory): The text that needs to be returned\n\n\n\n## Gulp Task\n\nAdd this to your existing gulp task.\n\n\n    \n```\nvar gulp = require('gulp');\nvar i18nize = require('i18nize');\nvar paths = {\n  locales: ['locales/index.csv']\n};\n\ngulp.task('upload', function() {\n  return gulp.src(paths.locales)\n    .pipe(i18nize.upload({\n        neoConnectionString : \"Enter your Neo4j connection string here. eg: http://neo4j:pass@localhost:7474\",\n        appName: \"Enter your namespace here. eg:paypal.appstore\"\n    }))\n    .pipe(i18nize.translate ({        \n        engine : \"Enter yandex or google here\",\n        engineKey : \"Enter your engine key here\",\n        languages : [\"Default language 1 eg:ja\", \"Default language 2\", ..., \"Default language n\"],\n        appName: \"Enter your namespace here. eg:paypal.appstore\"\n    }));\n\n});\n\n\n```\n\n","defaultMarkerLayerId":"0","markerLayers":{"0":{"id":"0","maintainHistory":false,"markersById":{},"version":2},"1":{"id":"1","maintainHistory":false,"markersById":{},"version":2},"2":{"id":"2","maintainHistory":true,"markersById":{"1":{"range":{"start":{"row":19,"column":46},"end":{"row":19,"column":46}},"properties":{"type":"selection","preserveFolds":true,"goalScreenRange":null},"reversed":false,"tailed":false,"valid":true,"invalidate":"never"}},"version":2},"3":{"id":"3","maintainHistory":false,"markersById":{},"version":2}},"nextMarkerLayerId":4,"history":{"version":3,"nextCheckpointId":1,"undoStack":[],"redoStack":[]},"encoding":"utf8","filePath":"/Users/vmaudgalya/projects/merchant-experience-platform/uploader/readme.md","digestWhenLastPersisted":"ddb00367fdaaee7cefb83103c8b4c65d7d67b0e6","preferredLineEnding":null,"nextMarkerId":14,"deserializer":"TextBuffer","version":5},{"id":"087046681fa67112ba66bc708200969a","text":"USING PERIODIC COMMIT\n\nLOAD CSV WITH HEADERS FROM 'http://{{hostURI}}/index_upload.csv' AS row FIELDTERMINATOR\n  ','\n\nMERGE (b:Bundle {name : \"{{appName}}\"})\nMERGE (w:Word {key: row.key})\nMERGE (t:Translation {text: row.value})\nMERGE (b)-[:CONTAINS {}]->(w)\n\n{{colsCypher}}\n","defaultMarkerLayerId":"0","markerLayers":{"0":{"id":"0","maintainHistory":false,"markersById":{},"version":2},"1":{"id":"1","maintainHistory":false,"markersById":{},"version":2},"2":{"id":"2","maintainHistory":true,"markersById":{"1":{"range":{"start":{"row":0,"column":0},"end":{"row":0,"column":0}},"properties":{"type":"selection"},"reversed":false,"tailed":false,"valid":true,"invalidate":"never"}},"version":2}},"nextMarkerLayerId":3,"history":{"version":3,"nextCheckpointId":1,"undoStack":[],"redoStack":[]},"encoding":"utf8","filePath":"/Users/vmaudgalya/projects/merchant-experience-platform/uploader/lib/upload.tmpl","digestWhenLastPersisted":"436642ea5c81ab59fe2d7c0347e0826b57640ec7","preferredLineEnding":null,"nextMarkerId":2,"deserializer":"TextBuffer","version":5}]},"workspace":{"deserializer":"Workspace","paneContainer":{"deserializer":"PaneContainer","version":1,"root":{"deserializer":"Pane","id":3,"items":[{"deserializer":"TextEditor","id":52,"softTabs":true,"firstVisibleScreenRow":0,"firstVisibleScreenColumn":0,"displayBuffer":{"deserializer":"DisplayBuffer","id":53,"softWrapped":false,"tokenizedBuffer":{"deserializer":"TokenizedBuffer","bufferPath":"/Users/vmaudgalya/projects/merchant-experience-platform/uploader/lib/_process_col.tmpl","bufferId":"c8c7ee8fd8ba740f3b239554105a78c0","largeFileMode":false},"largeFileMode":false,"foldsMarkerLayerId":"1"},"selectionsMarkerLayerId":"2"},{"deserializer":"TextEditor","id":56,"softTabs":true,"firstVisibleScreenRow":0,"firstVisibleScreenColumn":0,"displayBuffer":{"deserializer":"DisplayBuffer","id":57,"softWrapped":false,"tokenizedBuffer":{"deserializer":"TokenizedBuffer","bufferPath":"/Users/vmaudgalya/projects/merchant-experience-platform/uploader/index.js","bufferId":"8895ffe32253885b76f652ff82e6b9ed","largeFileMode":false},"largeFileMode":false,"foldsMarkerLayerId":"1"},"selectionsMarkerLayerId":"2"},{"deserializer":"TextEditor","id":60,"softTabs":true,"firstVisibleScreenRow":0,"firstVisibleScreenColumn":0,"displayBuffer":{"deserializer":"DisplayBuffer","id":61,"softWrapped":false,"tokenizedBuffer":{"deserializer":"TokenizedBuffer","bufferPath":"/Users/vmaudgalya/projects/merchant-experience-platform/uploader/lib/Uploader.js","bufferId":"952d2bf8871a2d7b4ddf9d6b4c898329","largeFileMode":false},"largeFileMode":false,"foldsMarkerLayerId":"1"},"selectionsMarkerLayerId":"2"},{"deserializer":"TextEditor","id":64,"softTabs":true,"firstVisibleScreenRow":3,"firstVisibleScreenColumn":0,"displayBuffer":{"deserializer":"DisplayBuffer","id":65,"softWrapped":true,"tokenizedBuffer":{"deserializer":"TokenizedBuffer","bufferPath":"/Users/vmaudgalya/projects/merchant-experience-platform/uploader/readme.md","bufferId":"d6b7a5d3194201140a602d302591424c","largeFileMode":false},"largeFileMode":false,"foldsMarkerLayerId":"1"},"selectionsMarkerLayerId":"2"},{"deserializer":"TextEditor","id":68,"softTabs":true,"firstVisibleScreenRow":0,"firstVisibleScreenColumn":0,"displayBuffer":{"deserializer":"DisplayBuffer","id":69,"softWrapped":false,"tokenizedBuffer":{"deserializer":"TokenizedBuffer","bufferPath":"/Users/vmaudgalya/projects/merchant-experience-platform/uploader/lib/upload.tmpl","bufferId":"087046681fa67112ba66bc708200969a","largeFileMode":false},"largeFileMode":false,"foldsMarkerLayerId":"1"},"selectionsMarkerLayerId":"2"}],"activeItemURI":"/Users/vmaudgalya/projects/merchant-experience-platform/uploader/lib/upload.tmpl","focused":true,"flexScale":1},"activePaneId":3},"packagesWithActiveGrammars":["language-html","language-babel","language-gfm","language-hyperlink","language-todo"],"destroyedItemURIs":["/Users/vmaudgalya/.Trash/Translator.js","/Users/vmaudgalya/projects/merchant-experience-platform/uploader/package.json"]},"packageStates":{"linter":{"scope":"File"},"pigments":{"project":{"deserializer":"ColorProject","timestamp":"2016-02-08T18:57:00.779Z","version":"1.0.1","markersVersion":"1.0.5","globalSourceNames":["**/*.styl","**/*.stylus","**/*.less","**/*.sass","**/*.scss"],"globalIgnoredNames":["vendor/*","node_modules/*","spec/*","test/*"],"buffers":{"52":{"id":52,"path":"/Users/vmaudgalya/projects/merchant-experience-platform/uploader/lib/_process_col.tmpl","colorMarkers":[]},"56":{"id":56,"path":"/Users/vmaudgalya/projects/merchant-experience-platform/uploader/index.js","colorMarkers":[]},"60":{"id":60,"path":"/Users/vmaudgalya/projects/merchant-experience-platform/uploader/lib/Uploader.js","colorMarkers":[]},"64":{"id":64,"path":"/Users/vmaudgalya/projects/merchant-experience-platform/uploader/readme.md","colorMarkers":[]},"68":{"id":68,"path":"/Users/vmaudgalya/projects/merchant-experience-platform/uploader/lib/upload.tmpl","colorMarkers":[]}},"paths":[],"variables":{"deserializer":"VariablesCollection","content":[]}}},"find-and-replace":{"findOptions":{"findPattern":"db","replacePattern":"","pathsPattern":"","useRegex":false,"wholeWord":false,"caseSensitive":false,"inCurrentSelection":false},"findHistory":["upload","process","db"],"replaceHistory":[],"pathsHistory":[]},"fuzzy-finder":{"/Users/vmaudgalya/projects/merchant-experience-platform/uploader/lib/_process_col.tmpl":1454709680185,"/Users/vmaudgalya/projects/merchant-experience-platform/uploader/index.js":1454709683916,"/Users/vmaudgalya/projects/merchant-experience-platform/uploader/lib/Uploader.js":1454709699274,"/Users/vmaudgalya/projects/merchant-experience-platform/uploader/readme.md":1454957795307,"/Users/vmaudgalya/projects/merchant-experience-platform/uploader/lib/upload.tmpl":1454957803440},"keybinding-resolver":{},"metrics":{"sessionLength":25464},"tabs":[{}],"tree-view":{"directoryExpansionStates":{"/Users/vmaudgalya/projects/merchant-experience-platform/uploader":{"isExpanded":true,"entries":{"lib":{"isExpanded":true,"entries":{}},"node_modules":{"isExpanded":false,"entries":{}}}}},"selectedPath":"/Users/vmaudgalya/projects/merchant-experience-platform/uploader/node_modules","hasFocus":false,"attached":true,"scrollLeft":0,"scrollTop":0,"width":200}},"fullScreen":false}